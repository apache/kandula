<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:st1="urn:schemas-microsoft-com:office:smarttags"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 10">
<meta name=Originator content="Microsoft Word 10">
<link rel=File-List href="ws-tx_files/filelist.xml">
<link rel=Edit-Time-Data href="ws-tx_files/editdata.mso">
<!--[if !mso]>
<style>
v\:* {behavior:url(#default#VML);}
o\:* {behavior:url(#default#VML);}
w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
</style>
<![endif]-->
<title>CHAPTER 1</title>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="City"/>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="place"/>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>PUBLISHING</o:Author>
  <o:LastAuthor>PUBLISHING</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:TotalTime>1</o:TotalTime>
  <o:Created>2004-09-21T14:23:00Z</o:Created>
  <o:LastSaved>2004-09-21T14:23:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>5008</o:Words>
  <o:Characters>28546</o:Characters>
  <o:Company>SARASAVI</o:Company>
  <o:Lines>237</o:Lines>
  <o:Paragraphs>66</o:Paragraphs>
  <o:CharactersWithSpaces>33488</o:CharactersWithSpaces>
  <o:Version>10.3501</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:SpellingState>Clean</w:SpellingState>
  <w:GrammarState>Clean</w:GrammarState>
  <w:DrawingGridHorizontalSpacing>9.05 pt</w:DrawingGridHorizontalSpacing>
  <w:DrawingGridVerticalSpacing>9.05 pt</w:DrawingGridVerticalSpacing>
  <w:DisplayHorizontalDrawingGridEvery>0</w:DisplayHorizontalDrawingGridEvery>
  <w:UseMarginsForDrawingGridOrigin/>
  <w:DrawingGridHorizontalOrigin>89.85 pt</w:DrawingGridHorizontalOrigin>
  <w:DrawingGridVerticalOrigin>72 pt</w:DrawingGridVerticalOrigin>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if !mso]><object
 classid="clsid:38481807-CA0E-42D2-BF39-B33AF135CC4D" id=ieooui></object>
<style>
st1\:*{behavior:url(#ieooui) }
</style>
<![endif]-->
<style>
<!--
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:6.0pt;
	margin-left:0cm;
	line-height:150%;
	mso-pagination:widow-orphan;
	font-size:11.0pt;
	mso-bidi-font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
h1
	{mso-style-next:Normal;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:12.0pt;
	margin-left:0cm;
	text-indent:0cm;
	line-height:150%;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:1;
	mso-list:l4 level1 lfo2;
	font-size:14.0pt;
	font-family:Arial;
	text-transform:uppercase;
	mso-font-kerning:16.0pt;}
h2
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:0cm;
	text-indent:0cm;
	line-height:150%;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:2;
	mso-list:l4 level2 lfo2;
	font-size:12.0pt;
	font-family:Arial;
	font-variant:small-caps;
	mso-bidi-font-style:italic;}
h3
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:0cm;
	text-indent:0cm;
	line-height:150%;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:3;
	mso-list:l4 level3 lfo2;
	font-size:11.0pt;
	font-family:Arial;
	font-variant:small-caps;}
h4
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:0cm;
	text-indent:0cm;
	line-height:150%;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:4;
	mso-list:l4 level4 lfo2;
	font-size:11.0pt;
	font-family:"Times New Roman";
	font-variant:small-caps;
	font-weight:normal;
	mso-bidi-font-weight:bold;
	text-decoration:underline;
	text-underline:single;}
p.MsoCaption, li.MsoCaption, div.MsoCaption
	{mso-style-noshow:yes;
	mso-style-next:Normal;
	margin-top:6.0pt;
	margin-right:0cm;
	margin-bottom:6.0pt;
	margin-left:0cm;
	line-height:150%;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	font-weight:bold;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;
	text-underline:single;}
p.NormalIndented, li.NormalIndented, div.NormalIndented
	{mso-style-name:"Normal Indented";
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:6.0pt;
	margin-left:0cm;
	text-indent:36.0pt;
	line-height:150%;
	mso-pagination:widow-orphan;
	font-size:11.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
span.Inlinecode
	{mso-style-name:"Inline code";
	mso-ansi-font-size:9.0pt;
	font-family:"Courier New";
	mso-ascii-font-family:"Courier New";
	mso-hansi-font-family:"Courier New";
	mso-bidi-font-family:"Courier New";}
p.StyleHeading1NotBoldNotAllcaps, li.StyleHeading1NotBoldNotAllcaps, div.StyleHeading1NotBoldNotAllcaps
	{mso-style-name:"Style Heading 1 + Not Bold Not All caps";
	mso-style-parent:"Heading 1";
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:12.0pt;
	margin-left:0cm;
	text-indent:0cm;
	line-height:150%;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:1;
	mso-list:l4 level1 lfo2;
	font-size:14.0pt;
	font-family:Arial;
	mso-fareast-font-family:"Times New Roman";
	mso-font-kerning:16.0pt;
	font-weight:bold;
	mso-bidi-font-weight:normal;}
span.SpellE
	{mso-style-name:"";
	mso-spl-e:yes;}
span.GramE
	{mso-style-name:"";
	mso-gram-e:yes;}
@page Section1
	{size:612.0pt 792.0pt;
	margin:72.0pt 90.0pt 72.0pt 90.0pt;
	mso-header-margin:35.4pt;
	mso-footer-margin:35.4pt;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
 /* List Definitions */
 @list l0
	{mso-list-id:53939394;
	mso-list-type:hybrid;
	mso-list-template-ids:549738644 -1 -1 -1 -1 -1 -1 -1 -1 -1;}
@list l0:level1
	{mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l0:level2
	{mso-level-tab-stop:72.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l0:level3
	{mso-level-tab-stop:108.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l0:level4
	{mso-level-tab-stop:144.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l0:level5
	{mso-level-tab-stop:180.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l0:level6
	{mso-level-tab-stop:216.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l0:level7
	{mso-level-tab-stop:252.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l0:level8
	{mso-level-tab-stop:288.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l0:level9
	{mso-level-tab-stop:324.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l1
	{mso-list-id:149489480;
	mso-list-template-ids:-70637234;}
@list l1:level1
	{mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l2
	{mso-list-id:167525061;
	mso-list-template-ids:-70637234;}
@list l2:level1
	{mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l3
	{mso-list-id:632636436;
	mso-list-template-ids:-535937858;}
@list l3:level1
	{mso-level-suffix:none;
	mso-level-text:%1;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:0cm;
	text-indent:0cm;}
@list l3:level2
	{mso-level-suffix:space;
	mso-level-text:"%1\.%2";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:0cm;
	text-indent:0cm;}
@list l3:level3
	{mso-level-suffix:space;
	mso-level-text:"%1\.%2\.%3";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:0cm;
	text-indent:0cm;}
@list l3:level4
	{mso-level-suffix:space;
	mso-level-text:"%1\.%2\.%3\.%4";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:0cm;
	text-indent:0cm;}
@list l3:level5
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.";
	mso-level-tab-stop:126.0pt;
	mso-level-number-position:left;
	margin-left:111.6pt;
	text-indent:-39.6pt;}
@list l3:level6
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.";
	mso-level-tab-stop:144.0pt;
	mso-level-number-position:left;
	margin-left:136.8pt;
	text-indent:-46.8pt;}
@list l3:level7
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.";
	mso-level-tab-stop:180.0pt;
	mso-level-number-position:left;
	margin-left:162.0pt;
	text-indent:-54.0pt;}
@list l3:level8
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.%8\.";
	mso-level-tab-stop:198.0pt;
	mso-level-number-position:left;
	margin-left:187.2pt;
	text-indent:-61.2pt;}
@list l3:level9
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.%8\.%9\.";
	mso-level-tab-stop:234.0pt;
	mso-level-number-position:left;
	margin-left:216.0pt;
	text-indent:-72.0pt;}
@list l4
	{mso-list-id:732853926;
	mso-list-template-ids:-226445856;}
@list l4:level1
	{mso-level-style-link:"Heading 1";
	mso-level-suffix:none;
	mso-level-text:"%1  ";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:0cm;
	text-indent:0cm;}
@list l4:level2
	{mso-level-style-link:"Heading 2";
	mso-level-suffix:space;
	mso-level-text:"%1\.%2";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:0cm;
	text-indent:0cm;}
@list l4:level3
	{mso-level-style-link:"Heading 3";
	mso-level-suffix:space;
	mso-level-text:"%1\.%2\.%3";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:0cm;
	text-indent:0cm;}
@list l4:level4
	{mso-level-style-link:"Heading 4";
	mso-level-suffix:space;
	mso-level-text:"%1\.%2\.%3\.%4";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:0cm;
	text-indent:0cm;}
@list l4:level5
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.";
	mso-level-tab-stop:126.0pt;
	mso-level-number-position:left;
	margin-left:111.6pt;
	text-indent:-39.6pt;}
@list l4:level6
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.";
	mso-level-tab-stop:144.0pt;
	mso-level-number-position:left;
	margin-left:136.8pt;
	text-indent:-46.8pt;}
@list l4:level7
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.";
	mso-level-tab-stop:180.0pt;
	mso-level-number-position:left;
	margin-left:162.0pt;
	text-indent:-54.0pt;}
@list l4:level8
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.%8\.";
	mso-level-tab-stop:198.0pt;
	mso-level-number-position:left;
	margin-left:187.2pt;
	text-indent:-61.2pt;}
@list l4:level9
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.%8\.%9\.";
	mso-level-tab-stop:234.0pt;
	mso-level-number-position:left;
	margin-left:216.0pt;
	text-indent:-72.0pt;}
@list l5
	{mso-list-id:928586579;
	mso-list-template-ids:67698717;}
@list l5:level1
	{mso-level-text:"%1\)";
	mso-level-tab-stop:18.0pt;
	mso-level-number-position:left;
	margin-left:18.0pt;
	text-indent:-18.0pt;}
@list l5:level2
	{mso-level-number-format:alpha-lower;
	mso-level-text:"%2\)";
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	margin-left:36.0pt;
	text-indent:-18.0pt;}
@list l5:level3
	{mso-level-number-format:roman-lower;
	mso-level-text:"%3\)";
	mso-level-tab-stop:54.0pt;
	mso-level-number-position:left;
	margin-left:54.0pt;
	text-indent:-18.0pt;}
@list l5:level4
	{mso-level-text:"\(%4\)";
	mso-level-tab-stop:72.0pt;
	mso-level-number-position:left;
	margin-left:72.0pt;
	text-indent:-18.0pt;}
@list l5:level5
	{mso-level-number-format:alpha-lower;
	mso-level-text:"\(%5\)";
	mso-level-tab-stop:90.0pt;
	mso-level-number-position:left;
	margin-left:90.0pt;
	text-indent:-18.0pt;}
@list l5:level6
	{mso-level-number-format:roman-lower;
	mso-level-text:"\(%6\)";
	mso-level-tab-stop:108.0pt;
	mso-level-number-position:left;
	margin-left:108.0pt;
	text-indent:-18.0pt;}
@list l5:level7
	{mso-level-tab-stop:126.0pt;
	mso-level-number-position:left;
	margin-left:126.0pt;
	text-indent:-18.0pt;}
@list l5:level8
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:144.0pt;
	mso-level-number-position:left;
	margin-left:144.0pt;
	text-indent:-18.0pt;}
@list l5:level9
	{mso-level-number-format:roman-lower;
	mso-level-tab-stop:162.0pt;
	mso-level-number-position:left;
	margin-left:162.0pt;
	text-indent:-18.0pt;}
@list l6
	{mso-list-id:1438211901;
	mso-list-type:hybrid;
	mso-list-template-ids:-1045894246 67698703 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l6:level1
	{mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l6:level2
	{mso-level-tab-stop:72.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l6:level3
	{mso-level-tab-stop:108.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l6:level4
	{mso-level-tab-stop:144.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l6:level5
	{mso-level-tab-stop:180.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l6:level6
	{mso-level-tab-stop:216.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l6:level7
	{mso-level-tab-stop:252.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l6:level8
	{mso-level-tab-stop:288.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l6:level9
	{mso-level-tab-stop:324.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";}
table.MsoTableGrid
	{mso-style-name:"Table Grid";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	border:solid windowtext 1.0pt;
	mso-border-alt:solid windowtext .5pt;
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-border-insideh:.5pt solid windowtext;
	mso-border-insidev:.5pt solid windowtext;
	mso-tstyle-vert-align:middle;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";}
table.MsoTableGridFirstRow
	{mso-style-name:"Table Grid";
	mso-table-condition:first-row;
	text-align:center;
	mso-ansi-font-weight:bold;}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="3074"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
</head>

<body lang=EN-US link=blue vlink=purple style='tab-interval:36.0pt'>

<div class=Section1>

<p class=StyleHeading1NotBoldNotAllcaps style='margin-left:0cm;text-indent:
0cm'><![if !supportLists]><span style='mso-fareast-font-family:Arial'><span
style='mso-list:Ignore'>1<span style='mso-spacerun:yes'>  </span></span></span><![endif]>TRANSACTION
MANAGEMENT IN WEB SERVICES<o:p></o:p></p>

<h2 style='margin-left:0cm;text-indent:0cm'><![if !supportLists]><span
style='mso-fareast-font-family:Arial;font-variant:normal !important;text-transform:
uppercase'><span style='mso-list:Ignore'>1.1 </span></span><![endif]><span
style='font-variant:normal !important;text-transform:uppercase'>Objective<o:p></o:p></span></h2>

<p class=MsoNormal>Provide an open source implementation for the web services
coordination and transaction management frameworks defined by WS-Coordination,
WS-AtomicTransaction and WS-<span class=SpellE>BusinessActivity</span>.<o:p></o:p></p>

<h2 style='margin-left:0cm;text-indent:0cm'><![if !supportLists]><span
style='mso-fareast-font-family:Arial;font-variant:normal !important;text-transform:
uppercase'><span style='mso-list:Ignore'>1.2 </span></span><![endif]><span
style='font-variant:normal !important;text-transform:uppercase'>Introduction<o:p></o:p></span></h2>

<p class=MsoNormal>The specifications WS-Coordination, WS-<span class=SpellE>AtomicTransaction</span>
and WS-<span class=SpellE>BusinessActivity</span>, released jointly by
Microsoft, IBM and BEA Systems define a framework for transaction management in
the web services environment. These specifications define mechanisms to create
activities, join into them and reach common agreement on the outcome of joint
operations in terms of on-the-wire protocols, including XML schema, WSDL, state
transition diagrams and state tables providing a basis, on which to build
interoperable, distributed applications that desire to coordinate joint work.</p>

<p class=NormalIndented>The operations of web service activities that are
common to explicit coordination are defined in the WS-Coordination
specification. The WS-<span class=SpellE>AtomicTransaction</span> and WS-<span
class=SpellE>BusinessActivity</span> specifications each define a type of
agreement coordination that addresses the needs of complementary classes of
activities. Both of them leverage WS-Coordination and jointly provide agreement
coordination infrastructure for tightly and loosely coupled activities, whether
short- or long-lived. In particular, activities that require the traditional
atomic, consistent, isolated and durable (ACID) properties of transactions are
natural users of WS-<span class=SpellE>AtomicTransaction</span>. Those
activities that require tentative operations that are visible to third parties
before the final outcome of an activity are natural users of WS-<span
class=SpellE>BusinessActivity</span>.</p>

<p class=NormalIndented>To complement the agreement coordination behaviors
prescribed by the protocols in WS-<span class=SpellE>AtomicTransaction</span>
and WS-<span class=SpellE>BusinessActivity</span>, they compose with other WS-*
specifications such as WS-Addressing, WS-Policy, WS-Security, WS-<span
class=SpellE>SecureConversation</span>, and WS-<span class=SpellE>ReliableMessaging</span>.
For example, in situations where WS-Policy is used to express necessary
pre-conditions for successful operation, the source must have knowledge of the
destination's policies and the source must be capable of formulating messages
that adhere to these policies. When a secure exchange of messages is required,
then the source and destination must have a security context. Agreement
coordination is independent of these other aspects of distributed applications
that may be needed for a given situation.</p>

<h2 style='margin-left:0cm;text-indent:0cm'><![if !supportLists]><span
style='mso-fareast-font-family:Arial;font-variant:normal !important;text-transform:
uppercase'><span style='mso-list:Ignore'>1.3 </span></span><![endif]><span
style='font-variant:normal !important;text-transform:uppercase'>Implementation<o:p></o:p></span></h2>

<h3 style='margin-left:0cm;text-indent:0cm'><![if !supportLists]><span
style='mso-fareast-font-family:Arial;font-variant:normal !important;text-transform:
uppercase'><span style='mso-list:Ignore'>1.3.1 </span></span><![endif]><span
style='font-variant:normal !important;text-transform:uppercase'>Architectural
design<o:p></o:p></span></h3>

<p class=MsoNormal align=center style='text-align:center;page-break-after:avoid'><!--[if gte vml 1]><v:shapetype
 id="_x0000_t75" coordsize="21600,21600" o:spt="75" o:preferrelative="t"
 path="m@4@5l@4@11@9@11@9@5xe" filled="f" stroked="f">
 <v:stroke joinstyle="miter"/>
 <v:formulas>
  <v:f eqn="if lineDrawn pixelLineWidth 0"/>
  <v:f eqn="sum @0 1 0"/>
  <v:f eqn="sum 0 0 @1"/>
  <v:f eqn="prod @2 1 2"/>
  <v:f eqn="prod @3 21600 pixelWidth"/>
  <v:f eqn="prod @3 21600 pixelHeight"/>
  <v:f eqn="sum @0 0 1"/>
  <v:f eqn="prod @6 1 2"/>
  <v:f eqn="prod @7 21600 pixelWidth"/>
  <v:f eqn="sum @8 21600 0"/>
  <v:f eqn="prod @7 21600 pixelHeight"/>
  <v:f eqn="sum @10 21600 0"/>
 </v:formulas>
 <v:path o:extrusionok="f" gradientshapeok="t" o:connecttype="rect"/>
 <o:lock v:ext="edit" aspectratio="t"/>
</v:shapetype><v:shape id="_x0000_i1027" type="#_x0000_t75" style='width:458.25pt;
 height:270.75pt'>
 <v:imagedata src="ws-tx_files/image001.gif" o:title="image015"/>
</v:shape><![endif]--><![if !vml]><img width=611 height=361
src="ws-tx_files/image001.gif" v:shapes="_x0000_i1027"><![endif]></p>

<p class=MsoCaption align=center style='text-align:center'>Figure <!--[if supportFields]><span
style='mso-element:field-begin'></span><span
style='mso-spacerun:yes'> </span>SEQ Figure \* ARABIC <span style='mso-element:
field-separator'></span><![endif]--><span style='mso-no-proof:yes'>1</span><!--[if supportFields]><span
style='mso-element:field-end'></span><![endif]-->: Architectural design of the
coordination service</p>

<p class=MsoNormal>A coordination service coordinates activities. Under the
model depicted in figure 1, each activity is coordinated by its own
coordinator. Henceforth the term coordinator will be used to refer to the
individual runtime components that coordinate activities. The term coordination
service will be used to refer to the aggregate of all component services such
as the activation, registration etc. </p>

<p class=NormalIndented>When a request is received at one of the endpoints,
unless the request is for creating a new activity, in which case a new
coordinator is created, it is simply passed on to the coordinator responsible
for the activity concerned. The respective coordinator then handles the
requested operation. As new activities are created and existing activities are
terminated, coordinators also get created and destroyed. Thus at any given
time, the number of active coordinators resident in the coordination service is
equal to the number of activities coordinated by service.</p>

<p class=NormalIndented>The coordination service maintains a central repository
of all active coordinators. When a new request arrives at any of the endpoints,
the activity identifier is used to lookup the coordinator coordinating the
particular activity to dispatch the request. To facilitate this process, the
coordination service uses activity identifier as a reference property [33] at
all of its endpoints. Individual endpoints however may use additional reference
properties depending on what is been handled and how.</p>

<p class=NormalIndented>The activation and registration endpoints are defined
by WS-Coordination specification. All other endpoints are defined by
coordination type specific specification such WS-<span class=SpellE>AtomicTransaction</span>,
WS-<span class=SpellE>BusinessActivity</span> etc. The activation endpoint
allows new activities to be created. The registration endpoint allows
participants to register for any activity (regardless of its type) coordinated
by the service. The purpose of all other endpoints is to facilitate
communication between participants and the coordination service based on
specific coordination protocols. Hence are known as protocol services. The set
of protocol services offered by the coordination service thus depends on the
type of activities coordinated by the service. Presently, the implementation
can only coordinate atomic transactions. Hence only protocol services supported
by the service (completion and coordinator protocol services) are, those
defined by WS-<span class=SpellE>AtomicTransaction</span> specification.</p>

<p class=NormalIndented>When a new activity is created, the coordination
service first determines its type: e.g. an atomic transaction, a business
activity etc.<span style='mso-spacerun:yes'>  </span>It then creates a
coordinator of appropriate kind to coordinate the activity. All coordinators
are required to implement operations defined by WS-Coordination: e.g. create a
coordination context for the activity, register participants etc. Additionally,
each coordinator is required to support all operations required of it by the
type of activity it coordinates. These operations are defined by the
specifications that define those specific coordination types: e.g. the
operations required of a coordinator coordinating atomic transactions are defined
in the WS-<span class=SpellE>AtomicTransaction</span> specification.</p>

<p class=NormalIndented>The design attempts to encapsulate the complexity of
coordinating different types of activities (e.g. atomic transactions, business
activities etc.) within a specialized set of coordinators while making use of
inheritance and polymorphism to support common functions required of all
coordinators by WS-Coordination. As a result the design can be extended to
support new types of activities by adding new coordinators capable of handling
the necessary protocols.</p>

<h3 style='margin-left:0cm;text-indent:0cm'><![if !supportLists]><span
style='mso-fareast-font-family:Arial;font-variant:normal !important;text-transform:
uppercase'><span style='mso-list:Ignore'>1.3.2 </span></span><![endif]><span
style='font-variant:normal !important;text-transform:uppercase'>Implementation
status<o:p></o:p></span></h3>

<p class=MsoNormal>Table 1 lists all operation presently supported by the
coordination service. These operations may be implemented by a coordination
service as either one-way operations or as request-response type operations. However,
the support for one-way operations is mandatory (refer to the WSDL s given in
the specifications). Additionally a coordination service may expose the same
operations under request-response message pattern. The current implementation
only supports request-response message pattern.</p>

<b><span style='font-size:10.0pt;line-height:150%;font-family:"Times New Roman";
mso-fareast-font-family:"Times New Roman";mso-ansi-language:EN-US;mso-fareast-language:
EN-US;mso-bidi-language:AR-SA'><br clear=all style='page-break-before:always'>
</span></b>

<p class=MsoCaption align=center style='text-align:center'>Table <!--[if supportFields]><span
style='mso-element:field-begin'></span><span
style='mso-spacerun:yes'> </span>SEQ Table \* ARABIC <span style='mso-element:
field-separator'></span><![endif]--><span style='mso-no-proof:yes'>1</span><!--[if supportFields]><span
style='mso-element:field-end'></span><![endif]-->: Operations implemented by
the coordination service</p>

<div align=center>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0 width=618
 style='width:463.8pt;border-collapse:collapse;border:none;mso-border-alt:solid windowtext .5pt;
 mso-yfti-tbllook:480;mso-padding-alt:0cm 5.4pt 0cm 5.4pt;mso-border-insideh:
 .5pt solid windowtext;mso-border-insidev:.5pt solid windowtext'>
 <tr style='mso-yfti-irow:-1'>
  <td width=86 style='width:64.6pt;border:solid windowtext 1.0pt;mso-border-alt:
  solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;mso-yfti-cnfc:1'><b
  style='mso-bidi-font-weight:normal'>Service<o:p></o:p></b></p>
  </td>
  <td width=63 style='width:47.5pt;border:solid windowtext 1.0pt;border-left:
  none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;mso-yfti-cnfc:1'><b
  style='mso-bidi-font-weight:normal'>Defined by<o:p></o:p></b></p>
  </td>
  <td width=182 style='width:136.85pt;border:solid windowtext 1.0pt;border-left:
  none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;mso-yfti-cnfc:1'><b
  style='mso-bidi-font-weight:normal'>WSDL Interface<o:p></o:p></b></p>
  </td>
  <td width=286 style='width:214.85pt;border:solid windowtext 1.0pt;border-left:
  none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center;mso-yfti-cnfc:1'><b
  style='mso-bidi-font-weight:normal'>Operation(s)<o:p></o:p></b></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:0'>
  <td width=86 style='width:64.6pt;border:solid windowtext 1.0pt;border-top:
  none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:200%'>Activation</p>
  </td>
  <td width=63 style='width:47.5pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:
  solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
  solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:200%'>WS-COOR</p>
  </td>
  <td width=182 style='width:136.85pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span class=SpellE><span class=Inlinecode><span
  style='font-size:9.0pt;mso-bidi-font-size:12.0pt;line-height:150%'>ActivationPortTypeRPC</span></span></span><span
  class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt;
  line-height:150%'><o:p></o:p></span></span></p>
  </td>
  <td width=286 style='width:214.85pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span class=SpellE><span class=Inlinecode><span
  style='font-size:9.0pt;mso-bidi-font-size:12.0pt;line-height:150%'>createCoordinationContextOperation</span></span></span><span
  class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt;
  line-height:150%'><o:p></o:p></span></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1'>
  <td width=86 style='width:64.6pt;border:solid windowtext 1.0pt;border-top:
  none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:200%'>Registration</p>
  </td>
  <td width=63 style='width:47.5pt;border-top:none;border-left:none;border-bottom:
  solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;mso-border-top-alt:
  solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
  solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:200%'>WS-COOR</p>
  </td>
  <td width=182 style='width:136.85pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span class=SpellE><span class=Inlinecode><span
  style='font-size:9.0pt;mso-bidi-font-size:12.0pt;line-height:150%'>RegistrationPortTypeRPC</span></span></span><span
  class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt;
  line-height:150%'><o:p></o:p></span></span></p>
  </td>
  <td width=286 style='width:214.85pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span class=SpellE><span class=Inlinecode><span
  style='font-size:9.0pt;mso-bidi-font-size:12.0pt;line-height:150%'>registerOperation</span></span></span><span
  class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt;
  line-height:150%'><o:p></o:p></span></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:2'>
  <td width=86 rowspan=2 style='width:64.6pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:200%'>Completion</p>
  </td>
  <td width=63 rowspan=2 style='width:47.5pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:200%'>WS-AT</p>
  </td>
  <td width=182 rowspan=2 style='width:136.85pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span class=SpellE><span class=Inlinecode><span
  style='font-size:9.0pt;mso-bidi-font-size:12.0pt;line-height:150%'>CompletionPortTypeRPC</span></span></span><span
  class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt;
  line-height:150%'><o:p></o:p></span></span></p>
  </td>
  <td width=286 style='width:214.85pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span class=SpellE><span class=Inlinecode><span
  style='font-size:9.0pt;mso-bidi-font-size:12.0pt;line-height:150%'>commitOperation</span></span></span><span
  class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt;
  line-height:150%'><o:p></o:p></span></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:3'>
  <td width=286 style='width:214.85pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span class=SpellE><span class=Inlinecode><span
  style='font-size:9.0pt;mso-bidi-font-size:12.0pt;line-height:150%'>rollbackOperation</span></span></span><span
  class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt;
  line-height:150%'><o:p></o:p></span></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:4'>
  <td width=86 rowspan=3 style='width:64.6pt;border:solid windowtext 1.0pt;
  border-top:none;mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:200%'>Coordinator</p>
  </td>
  <td width=63 rowspan=3 style='width:47.5pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal style='line-height:200%'>WS-AT</p>
  </td>
  <td width=182 rowspan=3 style='width:136.85pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span class=SpellE><span class=Inlinecode><span
  style='font-size:9.0pt;mso-bidi-font-size:12.0pt;line-height:150%'>CoordinatorPortTypeRPC</span></span></span><span
  class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt;
  line-height:150%'><o:p></o:p></span></span></p>
  </td>
  <td width=286 style='width:214.85pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span class=SpellE><span class=Inlinecode><span
  style='font-size:9.0pt;mso-bidi-font-size:12.0pt;line-height:150%'>replayOperation</span></span></span><span
  class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt;
  line-height:150%'><o:p></o:p></span></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:5'>
  <td width=286 style='width:214.85pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span class=SpellE><span class=Inlinecode><span
  style='font-size:9.0pt;mso-bidi-font-size:12.0pt;line-height:150%'>abortedOperation</span></span></span><span
  class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt;
  line-height:150%'><o:p></o:p></span></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:6;mso-yfti-lastrow:yes'>
  <td width=286 style='width:214.85pt;border-top:none;border-left:none;
  border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span class=SpellE><span class=Inlinecode><span
  style='font-size:9.0pt;mso-bidi-font-size:12.0pt;line-height:150%'>readOnlyOperation</span></span></span><span
  class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt;
  line-height:150%'><o:p></o:p></span></span></p>
  </td>
 </tr>
</table>

</div>

<h4 style='margin-left:0cm;text-indent:0cm'><![if !supportLists]><span
style='font-variant:normal !important;text-transform:uppercase;text-decoration:
none;text-underline:none'><span style='mso-list:Ignore'>1.3.2.1 </span></span><![endif]><span
style='font-variant:normal !important;text-transform:uppercase'>Server side<o:p></o:p></span></h4>

<p class=MsoNormal align=center style='text-align:center;page-break-after:avoid'><!--[if gte vml 1]><v:shape
 id="_x0000_i1028" type="#_x0000_t75" style='width:429.75pt;height:498pt'>
 <v:imagedata src="ws-tx_files/image002.gif" o:title="image023"/>
</v:shape><![endif]--><![if !vml]><img width=573 height=664
src="ws-tx_files/image002.gif" v:shapes="_x0000_i1028"><![endif]></p>

<p class=MsoCaption align=center style='text-align:center'>Figure <!--[if supportFields]><span
style='mso-element:field-begin'></span><span
style='mso-spacerun:yes'> </span>SEQ Figure \* ARABIC <span style='mso-element:
field-separator'></span><![endif]--><span style='mso-no-proof:yes'>2</span><!--[if supportFields]><span
style='mso-element:field-end'></span><![endif]-->: The class diagram-
coordination service (1)</p>

<p class=MsoNormal>All coordinator instances must implement the <span
class=SpellE><span class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:
12.0pt;line-height:150%;mso-bidi-font-family:"Times New Roman"'>WSCoordinator</span></span></span>
interface (see figure 45). This interface defines the basic requirements
expected of any type of coordinator e.g. creation of coordination contexts,
registration of participants, identifying the activity they coordinate etc.
Coordination type specific interfaces: e.g. <span class=SpellE><span
class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt;
line-height:150%;mso-bidi-font-family:"Times New Roman"'>WSAtomicTransactionCoordinator</span></span></span>,
extend from <span class=SpellE><span class=Inlinecode><span style='font-size:
9.0pt;mso-bidi-font-size:12.0pt;line-height:150%;mso-bidi-font-family:"Times New Roman"'>WSCoordinator</span></span></span>
and define the requirements of particular coordination types, i.e. Atomic
Transactions in this case.</p>

<p class=NormalIndented><span class=SpellE><span class=Inlinecode><span
style='font-size:9.0pt;mso-bidi-font-size:10.0pt;line-height:150%;mso-bidi-font-family:
"Times New Roman"'>WSCoordinatorImpl</span></span></span> is an abstract base
class that implements the <span class=SpellE><span class=Inlinecode><span
style='font-size:9.0pt;mso-bidi-font-size:10.0pt;line-height:150%;mso-bidi-font-family:
"Times New Roman"'>WSCoordinator</span></span></span> interface. It also
provides functions such as locking, required by all coordinators. All concrete
classes, e.g. <span class=SpellE><span class=Inlinecode><span style='font-size:
9.0pt;mso-bidi-font-size:10.0pt;line-height:150%;mso-bidi-font-family:"Times New Roman"'>WSAtomicTransactionCoordinatorImpl</span></span></span>,
that implement a particular coordination type extend from <span class=SpellE><span
class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:10.0pt;
line-height:150%;mso-bidi-font-family:"Times New Roman"'>WSCoordinatorImpl</span></span></span>.
<span class=SpellE><span class=Inlinecode><span style='font-size:9.0pt;
mso-bidi-font-size:10.0pt;line-height:150%;mso-bidi-font-family:"Times New Roman"'>WSCoordinatorImpl</span></span></span>
serves as an adaptor for its subclasses.</p>

<p class=NormalIndented>The <span class=SpellE><span class=Inlinecode><span
style='font-size:9.0pt;mso-bidi-font-size:10.0pt;line-height:150%;mso-bidi-font-family:
"Times New Roman"'>WSAtomicTransactionCoordinatorImpl</span></span></span>
implements the atomic transaction coordination type: for instance the method <span
class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:10.0pt;
line-height:150%;mso-bidi-font-family:"Times New Roman"'>commit</span></span>
carries out the two-phase commit protocol. It also implements operations
required by protocol services such as Completion and Coordinator [30].</p>

<p class=NormalIndented>The class <span class=SpellE><span class=Inlinecode><span
style='font-size:9.0pt;mso-bidi-font-size:10.0pt;line-height:150%;mso-bidi-font-family:
"Times New Roman"'>CoordinationService</span></span></span> shown in figure 46
is responsible for creating an appropriate coordinator for new or imported
activities. It also allows local transactions (JTA) to be imported into the
coordination service and to be coordinated as activities. For each activity
whose coordination type is Atomic Transaction, the coordination service creates
a new instance of the class <span class=SpellE><span class=Inlinecode><span
style='font-size:9.0pt;mso-bidi-font-size:10.0pt;line-height:150%;mso-bidi-font-family:
"Times New Roman"'>WSAtomicTransactionCoordinatorImpl</span></span></span>. For
each local transaction, imported into the coordinator, it creates an instance
of <span class=SpellE><span class=Inlinecode><span style='font-size:9.0pt;
mso-bidi-font-size:10.0pt;line-height:150%;mso-bidi-font-family:"Times New Roman"'>SurrogateWSAtomicTransactionCoordinator</span></span></span>.</p>

<p class=NormalIndented>The <span class=SpellE><span class=Inlinecode><span
style='font-size:9.0pt;mso-bidi-font-size:10.0pt;line-height:150%;mso-bidi-font-family:
"Times New Roman"'>SurrogateWSAtomicTransactionCoordinator</span></span></span>
registers it self as a participant of the local transaction passed to its
constructor and also implements the interface <span class=SpellE><span
class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:10.0pt;
line-height:150%;mso-bidi-font-family:"Times New Roman"'>javax.Transaction.xa.XAResource</span></span></span>
(see appendix C). When the local transaction is committed or rolled back the
class simply calls the corresponding methods of the <span class=SpellE><span
class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:10.0pt;
line-height:150%;mso-bidi-font-family:"Times New Roman"'>WSAtomicTransactionCoordinatorImpl</span></span></span>
(the super class) inside its <span class=SpellE><span class=Inlinecode><span
style='font-size:9.0pt;mso-bidi-font-size:10.0pt;line-height:150%;mso-bidi-font-family:
"Times New Roman"'>XAResource</span></span></span> implementation to extend the
scope of the two phase commit protocol carried out on local resources to
participants of the atomic transaction. The class overrides the <span
class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:10.0pt;
line-height:150%;mso-bidi-font-family:"Times New Roman"'>commit</span></span>
and <span class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:
10.0pt;line-height:150%;mso-bidi-font-family:"Times New Roman"'>rollback</span></span>
methods of the <span class=SpellE><span class=Inlinecode><span
style='font-size:9.0pt;mso-bidi-font-size:10.0pt;line-height:150%;mso-bidi-font-family:
"Times New Roman"'>WSAtomicTransactionCoordinatorImpl</span></span></span>. The
overridden methods simply call the <span class=Inlinecode><span
style='font-size:9.0pt;mso-bidi-font-size:10.0pt;line-height:150%;mso-bidi-font-family:
"Times New Roman"'>commit</span></span> and <span class=Inlinecode><span
style='font-size:9.0pt;mso-bidi-font-size:10.0pt;line-height:150%;mso-bidi-font-family:
"Times New Roman"'>rollback</span></span> methods of the local transaction
instead. This guarantees that the local transaction is committed (or rolled
back) if the atomic transaction is terminated first. As a result even when the
atomic transaction is terminated first, two-phase commit protocol is still
carried out by the local transaction manager rather than the atomic transaction
coordinator: i.e. <span class=SpellE><span class=Inlinecode><span
style='font-size:9.0pt;mso-bidi-font-size:10.0pt;line-height:150%;mso-bidi-font-family:
"Times New Roman"'>WSAtomicTransactionCoordinatorImpl</span></span></span>. </p>

<p class=MsoNormal align=center style='text-align:center;page-break-after:avoid'><span
style='mso-spacerun:yes'>  </span><!--[if gte vml 1]><v:shape id="_x0000_i1029"
 type="#_x0000_t75" style='width:293.25pt;height:131.25pt'>
 <v:imagedata src="ws-tx_files/image003.gif" o:title="image024"/>
</v:shape><![endif]--><![if !vml]><img width=391 height=175
src="ws-tx_files/image003.gif" v:shapes="_x0000_i1029"><![endif]></p>

<p class=MsoCaption align=center style='text-align:center'>Figure <!--[if supportFields]><span
style='mso-element:field-begin'></span><span
style='mso-spacerun:yes'> </span>SEQ Figure \* ARABIC <span style='mso-element:
field-separator'></span><![endif]--><span style='mso-no-proof:yes'>3</span><!--[if supportFields]><span
style='mso-element:field-end'></span><![endif]-->: Class diagram - coordination
service (2)</p>

<p class=MsoNormal>The <span class=SpellE><span class=Inlinecode><span
style='font-size:9.0pt;mso-bidi-font-size:12.0pt;line-height:150%;mso-bidi-font-family:
"Times New Roman"'>CoordinationService</span></span></span> class a singleton.
Apart from creating new coordinators the class is also used in dispatching
requests to respective coordinators by different service endpoints. The class
maintains a hash map of all active coordinators, keyed by their activity
identifiers. When a new request is received, the endpoint uses the reference
properties to locate the activity identifier of the activity to which the
request belongs. Then the <span class=SpellE><span class=Inlinecode><span
style='font-size:9.0pt;mso-bidi-font-size:12.0pt;line-height:150%;mso-bidi-font-family:
"Times New Roman"'>getCoordinator</span></span></span> method of <span
class=SpellE><span class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:
12.0pt;line-height:150%;mso-bidi-font-family:"Times New Roman"'>CoordinationService</span></span></span>
is used to obtain a reference to the coordinator coordinating the activity.</p>

<h4 style='margin-left:0cm;text-indent:0cm'><![if !supportLists]><span
style='font-variant:normal !important;text-transform:uppercase;text-decoration:
none;text-underline:none'><span style='mso-list:Ignore'>1.3.2.2 </span></span><![endif]><span
style='font-variant:normal !important;text-transform:uppercase'>Client side
(standalone)<o:p></o:p></span></h4>

<p class=MsoNormal>The <span class=SpellE><span class=Inlinecode><span
style='font-size:9.0pt;mso-bidi-font-size:12.0pt;line-height:150%;mso-bidi-font-family:
"Times New Roman"'>TransactionManager</span></span></span> class shown in
figure 47 is used by standalone clients to demarcate transaction boundaries. The
<span class=SpellE><span class=Inlinecode><span style='font-size:9.0pt;
mso-bidi-font-size:12.0pt;line-height:150%;mso-bidi-font-family:"Times New Roman"'>TransactionManager</span></span></span>
maintains the transaction context associated with each thread as part of its
internal data structure. A thread’s transaction context is either null or
refers to a specific atomic transaction. Each transaction is encapsulated by a <span
class=SpellE><span class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:
12.0pt;line-height:150%;mso-bidi-font-family:"Times New Roman"'>WSAtomicTransaction</span></span></span>
object, which can be used to perform operations which are specific to the
target transaction, regardless of the calling thread’s transaction context. The
<span class=SpellE><span class=Inlinecode><span style='font-size:9.0pt;
mso-bidi-font-size:12.0pt;line-height:150%;mso-bidi-font-family:"Times New Roman"'>TransactionManager</span></span></span>
class is the web service equivalent of JTA <span class=SpellE><span
class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt;
line-height:150%;mso-bidi-font-family:"Times New Roman"'>javax.transaction.TransactionManager</span></span></span>
(see appendix C).</p>

<p class=MsoNormal align=center style='text-align:center;page-break-after:avoid'><!--[if gte vml 1]><v:shape
 id="_x0000_i1030" type="#_x0000_t75" style='width:255pt;height:393.75pt'>
 <v:imagedata src="ws-tx_files/image004.gif" o:title="image028"/>
</v:shape><![endif]--><![if !vml]><img width=340 height=525
src="ws-tx_files/image004.gif" v:shapes="_x0000_i1030"><![endif]></p>

<p class=MsoCaption align=center style='text-align:center'>Figure <!--[if supportFields]><span
style='mso-element:field-begin'></span><span
style='mso-spacerun:yes'> </span>SEQ Figure \* ARABIC <span style='mso-element:
field-separator'></span><![endif]--><span style='mso-no-proof:yes'>4</span><!--[if supportFields]><span
style='mso-element:field-end'></span><![endif]-->: The class diagram-
coordination service (3)</p>

<p class=MsoNormal>The <span class=SpellE><span class=Inlinecode><span
style='font-size:9.0pt;mso-bidi-font-size:12.0pt;line-height:150%;mso-bidi-font-family:
"Times New Roman"'>WSAtomicTransactionHandler</span></span></span> is
responsible for flowing the executing thread’s transaction context. It does so
by checking with the <span class=SpellE><span class=Inlinecode><span
style='font-size:9.0pt;mso-bidi-font-size:12.0pt;line-height:150%;mso-bidi-font-family:
"Times New Roman"'>TransactionManager</span></span></span> whether the current
thread has a transaction context whenever the Client Axis Engine calls it’s
invoke method on request flow [20]. If the thread has a transaction context it
obtains the respective coordination context by calling the <span class=SpellE><span
class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt;
line-height:150%;mso-bidi-font-family:"Times New Roman"'>getCoordinationContext</span></span></span>
method of the <span class=SpellE><span class=Inlinecode><span style='font-size:
9.0pt;mso-bidi-font-size:12.0pt;line-height:150%;mso-bidi-font-family:"Times New Roman"'>WSAtomicTransaction</span></span></span>
object representing the particular transaction. The coordination context is
then added to the SOAP header of the request message as stipulated by
WS-Coordination.</p>

<p class=MsoNormal align=center style='text-align:center;page-break-after:avoid'><!--[if mso & !supportInlineShapes & supportFields]><span
style='mso-element:field-begin;mso-field-lock:yes'></span><span
style='mso-spacerun:yes'> </span>SHAPE<span style='mso-spacerun:yes'> 
</span>\* MERGEFORMAT <span style='mso-element:field-separator'></span><![endif]--><!--[if gte vml 1]><v:shapetype
 id="_x0000_t202" coordsize="21600,21600" o:spt="202" path="m,l,21600r21600,l21600,xe">
 <v:stroke joinstyle="miter"/>
 <v:path gradientshapeok="t" o:connecttype="rect"/>
</v:shapetype><v:shape id="_x0000_s1036" type="#_x0000_t202" style='width:6in;
 height:340.5pt;mso-position-horizontal-relative:char;
 mso-position-vertical-relative:line' filled="f">
 <v:textbox style='mso-next-textbox:#_x0000_s1036'>
  <![if !mso]>
  <table cellpadding=0 cellspacing=0 width="100%">
   <tr>
    <td><![endif]>
    <div>
    <p class=MsoNormal style='line-height:normal'><span class=GramE><span
    style='font-size:9.0pt;font-family:"Courier New"'>import</span></span><span
    style='font-size:9.0pt;font-family:"Courier New"'> <span class=SpellE>wsatimpl.coordinator.TransactionManager</span>;<o:p></o:p></span></p>
    <p class=MsoNormal style='line-height:normal'><span class=GramE><span
    style='font-size:9.0pt;font-family:"Courier New"'>public</span></span><span
    style='font-size:9.0pt;font-family:"Courier New"'> class <span
    class=SpellE>BankClient</span> {<o:p></o:p></span></p>
    <p class=MsoNormal style='line-height:normal'><span style='font-size:9.0pt;
    font-family:"Courier New"'>&nbsp;&nbsp;&nbsp;&nbsp; <span class=GramE>public</span>
    static void main(String[] <span class=SpellE>args</span>) {<o:p></o:p></span></p>
    <p class=MsoNormal style='line-height:normal'><span style='font-size:9.0pt;
    font-family:"Courier New"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    <span class=GramE>try</span> {<o:p></o:p></span></p>
    <p class=MsoNormal style='line-height:normal'><span style='font-size:9.0pt;
    font-family:"Courier New"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    Bank <span class=SpellE>bank</span>= new <span class=SpellE><span
    class=GramE>BankServiceLocator</span></span><span class=GramE>(</span>).<span
    class=SpellE>getBank</span>();<o:p></o:p></span></p>
    <p class=MsoNormal style='line-height:normal'><span style='font-size:9.0pt;
    font-family:"Courier New"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    <span class=SpellE>TransactionManager</span> tm= <span class=SpellE><span
    class=GramE>TransactionManager.getInstance</span></span><span class=GramE>(</span>);<o:p></o:p></span></p>
    <p class=MsoNormal style='line-height:normal'><span style='font-size:9.0pt;
    font-family:"Courier New"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    //<span style='mso-spacerun:yes'>   </span>transfer <span class=SpellE>Rs</span>.
    10.00 from account 1002 to 1001<o:p></o:p></span></p>
    <p class=MsoNormal style='line-height:normal'><span style='font-size:9.0pt;
    font-family:"Courier New"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    //&nbsp;&nbsp; start a new transaction<o:p></o:p></span></p>
    <p class=MsoNormal style='line-height:normal'><span style='font-size:9.0pt;
    font-family:"Courier New"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    <span class=SpellE><span class=GramE>tm.begin</span></span><span
    class=GramE>(</span>);<o:p></o:p></span></p>
    <p class=MsoNormal style='line-height:normal'><span style='font-size:9.0pt;
    font-family:"Courier New"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    //&nbsp;&nbsp; invoke the target service<o:p></o:p></span></p>
    <p class=MsoNormal style='line-height:normal'><span style='font-size:9.0pt;
    font-family:"Courier New"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    <span class=SpellE><span class=GramE>bank.credit</span></span><span
    class=GramE>(</span>1001, 10);<o:p></o:p></span></p>
    <p class=MsoNormal style='line-height:normal'><span style='font-size:9.0pt;
    font-family:"Courier New"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    <span class=SpellE><span class=GramE>bank.debit</span></span><span
    class=GramE>(</span>1002, 10);<o:p></o:p></span></p>
    <p class=MsoNormal style='line-height:normal'><span style='font-size:9.0pt;
    font-family:"Courier New"'><span style='mso-tab-count:3'>                     </span><span
    style='mso-spacerun:yes'> </span>...<o:p></o:p></span></p>
    <p class=MsoNormal style='line-height:normal'><span style='font-size:9.0pt;
    font-family:"Courier New"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    //&nbsp;&nbsp; rollback the transaction<o:p></o:p></span></p>
    <p class=MsoNormal style='line-height:normal'><span style='font-size:9.0pt;
    font-family:"Courier New"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    <span class=SpellE><span class=GramE>tm.rollback</span></span><span
    class=GramE>(</span>);<o:p></o:p></span></p>
    <p class=MsoNormal style='line-height:normal'><span style='font-size:9.0pt;
    font-family:"Courier New"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    }<o:p></o:p></span></p>
    <p class=MsoNormal style='line-height:normal'><span style='font-size:9.0pt;
    font-family:"Courier New"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    <span class=GramE>catch</span> (Exception e) {<o:p></o:p></span></p>
    <p class=MsoNormal style='line-height:normal'><span style='font-size:9.0pt;
    font-family:"Courier New"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    <span class=SpellE><span class=GramE>e.printStackTrace</span></span><span
    class=GramE>(</span>);<o:p></o:p></span></p>
    <p class=MsoNormal style='line-height:normal'><span style='font-size:9.0pt;
    font-family:"Courier New"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    }<o:p></o:p></span></p>
    <p class=MsoNormal style='line-height:normal'><span style='font-size:9.0pt;
    font-family:"Courier New"'>&nbsp;&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p>
    <p class=MsoNormal style='line-height:normal'><span style='font-size:9.0pt;
    font-family:"Courier New"'>}<o:p></o:p></span></p>
    <p class=MsoNormal style='line-height:normal'><span style='font-size:9.0pt;
    font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>
    <p class=MsoNormal style='line-height:normal'><span style='font-size:9.0pt;
    font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>
    </div>
    <![if !mso]></td>
   </tr>
  </table>
  <![endif]></v:textbox>
 <w:wrap type="none" side="left"/>
 <w:anchorlock/>
</v:shape><![endif]--><![if !vml]><img width=582 height=460
src="ws-tx_files/image005.gif"
alt="Text Box: import wsatimpl.coordinator.TransactionManager;&#13;&#10;public class BankClient {&#13;&#10;     public static void main(String[] args) {&#13;&#10;           try {&#13;&#10;                Bank bank= new BankServiceLocator().getBank();&#13;&#10;                TransactionManager tm= TransactionManager.getInstance();&#13;&#10;                //   transfer Rs. 10.00 from account 1002 to 1001&#13;&#10;                //   start a new transaction&#13;&#10;                tm.begin();&#13;&#10;                //   invoke the target service&#13;&#10;                bank.credit(1001, 10);&#13;&#10;                bank.debit(1002, 10);&#13;&#10;			 ...&#13;&#10;                //   rollback the transaction&#13;&#10;                tm.rollback();&#13;&#10;           }&#13;&#10;           catch (Exception e) {&#13;&#10;                e.printStackTrace();&#13;&#10;           }&#13;&#10;     }&#13;&#10;}&#13;&#10;&#13;&#10;&#13;&#10;"
v:shapes="_x0000_s1036"><![endif]><!--[if mso & !supportInlineShapes & supportFields]><v:shape
 id="_x0000_i1025" type="#_x0000_t75" style='width:6in;height:340.5pt'>
 <v:imagedata croptop="-65520f" cropbottom="65520f"/>
</v:shape><span style='mso-element:field-end'></span><![endif]--></p>

<p class=MsoCaption align=center style='text-align:center'>Figure <!--[if supportFields]><span
style='mso-element:field-begin'></span><span
style='mso-spacerun:yes'> </span>SEQ Figure \* ARABIC <span style='mso-element:
field-separator'></span><![endif]--><span style='mso-no-proof:yes'>5</span><!--[if supportFields]><span
style='mso-element:field-end'></span><![endif]-->: Usage scenario - a
standalone client calling a transactional web service</p>

<p class=MsoNormal>Figure 48, shows a standalone client that uses the
implementation. The sequence diagram in figure 49 illustrates the depicted
scenario. The client attempts to transfer a sum of money through a Bank
service. The client first starts a new transaction by calling the <span
class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt;
line-height:150%;mso-bidi-font-family:"Times New Roman"'>begin</span></span>
method of the <span class=SpellE><span class=Inlinecode><span style='font-size:
9.0pt;mso-bidi-font-size:12.0pt;line-height:150%;mso-bidi-font-family:"Times New Roman"'>TransactionManager</span></span></span>.
This results in the creation of a new atomic transaction as shown in the
sequence diagram. Within the transaction it invokes operations that perform a
credit and a debit equal in amount to carry out the monetary transfer.
Afterwards, the transaction is rolled back aborting the monetary transfer by
calling the <span class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:
12.0pt;line-height:150%;mso-bidi-font-family:"Times New Roman"'>rollback</span></span>
method of the <span class=SpellE><span class=Inlinecode><span style='font-size:
9.0pt;mso-bidi-font-size:12.0pt;line-height:150%;mso-bidi-font-family:"Times New Roman"'>TransactionManager</span></span></span>.</p>

<p class=MsoNormal align=center style='text-align:center;page-break-after:avoid'><!--[if gte vml 1]><v:shape
 id="_x0000_i1031" type="#_x0000_t75" style='width:503.25pt;height:479.25pt'>
 <v:imagedata src="ws-tx_files/image006.gif" o:title="image002"/>
</v:shape><![endif]--><![if !vml]><img width=671 height=639
src="ws-tx_files/image006.gif" v:shapes="_x0000_i1031"><![endif]></p>

<p class=MsoCaption align=center style='text-align:center'>Figure <!--[if supportFields]><span
style='mso-element:field-begin'></span><span
style='mso-spacerun:yes'> </span>SEQ Figure \* ARABIC <span style='mso-element:
field-separator'></span><![endif]--><span style='mso-no-proof:yes'>6</span><!--[if supportFields]><span
style='mso-element:field-end'></span><![endif]-->: Sequence Diagram - a
standalone client calling a transactional web service</p>

<h4 style='margin-left:0cm;text-indent:0cm'><![if !supportLists]><span
style='font-variant:normal !important;text-transform:uppercase;text-decoration:
none;text-underline:none'><span style='mso-list:Ignore'>1.3.2.3 </span></span><![endif]><span
style='font-variant:normal !important;text-transform:uppercase'>Client side
(J2EE)<o:p></o:p></span></h4>

<p class=MsoNormal>On the J2EE platform, clients use JTA to manage
transactions. Hence there is no web service specific API for transaction
management. In fact it is awkward to define such an API. Instead, when a client
invokes a web service, the run-time implicitly exports the transaction context
associated with the current thread as an atomic transaction. The middleware to
augment J2EE runtime to perform this operation forms the subject of the next
chapter.</p>

<h3 style='margin-left:0cm;text-indent:0cm'><![if !supportLists]><span
style='mso-fareast-font-family:Arial;font-variant:normal !important;text-transform:
uppercase'><span style='mso-list:Ignore'>1.3.3 </span></span><![endif]><span
style='font-variant:normal !important;text-transform:uppercase'>Possible Future
Extensions<o:p></o:p></span></h3>

<p class=MsoNormal>In addition to supporting WS-<span class=SpellE>BusinessActivity</span>
the present WS-<span class=SpellE>AtomicTransaction</span> implementation needs
to be perfected to support numerous interoperability scenarios described in the
specification.</p>

<b style='mso-bidi-font-weight:normal'><span style='font-size:14.0pt;
line-height:150%;font-family:Arial;mso-fareast-font-family:"Times New Roman";
mso-font-kerning:16.0pt;mso-ansi-language:EN-US;mso-fareast-language:EN-US;
mso-bidi-language:AR-SA'><br clear=all style='page-break-before:always'>
</span></b>

<p class=StyleHeading1NotBoldNotAllcaps style='margin-left:0cm;text-indent:
0cm'><![if !supportLists]><span style='mso-fareast-font-family:Arial'><span
style='mso-list:Ignore'>2<span style='mso-spacerun:yes'>  </span></span></span><![endif]>TRANSACTION
MANAGEMENT IN <st1:City><st1:place>ENTERPRISE</st1:place></st1:City> WEB
SERVICES<o:p></o:p></p>

<h2 style='margin-left:0cm;text-indent:0cm'><![if !supportLists]><span
style='mso-fareast-font-family:Arial;font-variant:normal !important;text-transform:
uppercase'><span style='mso-list:Ignore'>2.1 </span></span><![endif]><span
style='font-variant:normal !important;text-transform:uppercase'>Objective<o:p></o:p></span></h2>

<p class=MsoNormal>Integrate existing open source JTA implementations (e.g.
JOTM, <span class=SpellE>JBoss</span>, Geronimo, etc.) with the web services
transaction management framework so that J2EE web services and clients may take
part in atomic transactions while using JTA for transaction management. In
other words, JTA implementations use JTS for transaction propagation between
J2EE domains. The objective is to facilitate propagation of JTA distributed
transactions via the web services coordination framework.<o:p></o:p></p>

<h2 style='margin-left:0cm;text-indent:0cm'><![if !supportLists]><span
style='mso-fareast-font-family:Arial;font-variant:normal !important;text-transform:
uppercase'><span style='mso-list:Ignore'>2.2 </span></span><![endif]><span
style='font-variant:normal !important;text-transform:uppercase'>Introduction<o:p></o:p></span></h2>

<h3 style='margin-left:0cm;text-indent:0cm'><![if !supportLists]><span
style='mso-fareast-font-family:Arial;font-variant:normal !important;text-transform:
uppercase'><span style='mso-list:Ignore'>2.2.1 </span></span><![endif]><span
style='font-variant:normal !important;text-transform:uppercase'>JSR109
Requirements &amp; Limits<o:p></o:p></span></h3>

<p class=MsoNormal>JSR 109 [1] discusses transactions at two junctures.</p>

<ol style='margin-top:0cm' start=1 type=1>
 <li class=MsoNormal style='mso-list:l0 level1 lfo5;tab-stops:list 36.0pt'>Under
     chapter 5, on server programming model, section 5.5 instructs: “The
     methods of a Service Implementation Bean run under a transaction context
     specific to the container. The web container runs the methods under an
     unspecified transaction context. The EJB container runs the methods under
     the transaction context defined by the container-transaction element of
     the EJB deployment descriptor.”</li>
 <li class=MsoNormal style='mso-list:l0 level1 lfo5;tab-stops:list 36.0pt'>In
     chapter 6 on Handlers, section 6.2.2.3 stipulates: “Handlers run under the
     transaction context of the component they are associated with. Handlers
     must not demarcate transactions using the <span class=SpellE><span
     class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt;
     line-height:150%;mso-bidi-font-family:"Times New Roman"'>javax.transaction.UserTransaction</span></span></span>
     interface.”</li>
</ol>

<p class=MsoNormal>Thus JSR 109 does not attempt to define how the web services
transaction framework described in the previous chapter should be interfaced
with the J2EE transaction model in the context of enterprise web services. In
other words JSR109 does not define what should be done in any of the following
instances:</p>

<ol style='margin-top:0cm' start=1 type=1>
 <li class=MsoNormal style='mso-list:l6 level1 lfo8;tab-stops:list 36.0pt'>The
     incoming web service request for a J2EE web service has a transaction
     context. This implies that the requested operation should be carried out
     under the given (or the client’s) transaction context (i.e. the given
     atomic transaction or business activity).</li>
 <li class=MsoNormal style='mso-list:l6 level1 lfo8;tab-stops:list 36.0pt'>The
     deployment descriptor of an EJB being exposed relies on the container for
     managing transactions and has methods that should only or should never be
     invoked under the client’s transaction context. (Please refer to chapter
     17 – “Support for Transactions”, section 17.6.2 – “Container-Managed
     Transaction Demarcation for Session and Entity Beans” in the EJB 2.1
     specification [34] for details on all possible transaction attributes of
     EJB methods)</li>
</ol>

<p class=MsoNormal>Instead it simply restates how the J2EE transaction model
should be used when web services are implemented on J2EE. The reason been at
the time when JSR 109 was formulated, WS-Coordination was not available.</p>

<h3 style='margin-left:0cm;text-indent:0cm'><![if !supportLists]><span
style='mso-fareast-font-family:Arial;font-variant:normal !important;text-transform:
uppercase'><span style='mso-list:Ignore'>2.2.2 </span></span><![endif]><span
style='font-variant:normal !important;text-transform:uppercase'>Beyond JSR109<o:p></o:p></span></h3>

<p class=MsoNormal>The motivation for using EJB s as against JAX-RPC service
endpoints [7] for implementing web services comes from their support for
transaction management [35]. Yet unless it is defined how the web services
transaction model should be interfaced with the J2EE transaction management
framework nothing will come out of this effort. Hence one of the primary
objectives of this project is to define what should be done when web services
transactions need to be propagated into J2EE and J2EE transactions need to be
propagated onto web services. The ultimate result is that a web service client
is able to invoke a J2EE web service as any other web service using WS-AT for
transaction management and yet the developer is free to use JTA for transaction
management when implementing the service. Further J2EE clients are able to use
JTA and yet invoke web services that expect client’s transaction context in the
form of an atomic transaction as described by WS-AT.</p>

<p class=NormalIndented>In the present context none of the above is possible.
Firstly, if a web service client using WS-AT sends a request to a J2EE web
service with a transaction context, the transaction context is ignored by the
runtime. Hence for the service implementation it appears as if the client has
no transaction context. Similarly, if a J2EE client makes a web service
invocation, the client’s transaction context is not propagated along the
service request. Once again as a result, for the service it appears as if the
client has no transaction context. Notice that though the end result is the
same in both scenarios the fault is at different ends. In the first scenario
the fault is on the server side since it is the runtime that is unable to
recognize the transaction context in the request. In the second scenario the
fault is on the client side since when the request is generated the runtime is
not putting in the client’s transaction context into the request. Yet in both
case the fault is with the J2EE runtime. This project rectifies this lapse by
augmenting the J2EE runtime with middleware that perform these tasks in a
transparent manner. </p>

<h3 style='margin-left:0cm;text-indent:0cm'><![if !supportLists]><span
style='mso-fareast-font-family:Arial;font-variant:normal !important;text-transform:
uppercase'><span style='mso-list:Ignore'>2.2.3 </span></span><![endif]><span
style='font-variant:normal !important;text-transform:uppercase'>Transaction
Management in </span><st1:City><st1:place><span style='font-variant:normal !important;
  text-transform:uppercase'>Enterprise</span></st1:place></st1:City><span
style='font-variant:normal !important;text-transform:uppercase'> Web Services<o:p></o:p></span></h3>

<p class=MsoNormal>The subsequent sections of this chapter present a design and
an implementation for middleware mentioned in the previous section. The session
being shown in figure 50 illustrates the result of this effort. The bean uses
container managed transaction demarcation (see appendix C, section C.4) and may
be used as a service implementation bean. Hence at runtime the thread’s
transaction context may come from two sources. It may be propagated from the
client or may be created by the container depending on the EJB deployment
descriptor and the nature of the client’s request (whether it had a transaction
context or not). If the deployment descriptor is set to support transactions
for the method (use <span class=Inlinecode><span style='font-size:9.0pt;
mso-bidi-font-size:12.0pt;line-height:150%;mso-bidi-font-family:"Times New Roman"'>Support</span></span>
as the transaction attribute of the method [34]), then at runtime the container
looks for a transaction context in client’s request. If it finds one the method
is executed in the context of that transaction. The method is executed under a
nil transaction context otherwise.</p>

<p class=NormalIndented>Under these circumstances the middleware described in
this chapter act as follows. At run time any atomic transaction associated with
the web service request is imported into J2EE as a local transaction. (Note
that the use of term local transaction here is different from its accepted
meaning in JCA). Hence to the EJB container it appears as if the client had a
transaction context. (The local transaction is associated with the calling
thread by the EWS runtime before the EJB called, see section 11.3.1.1
Transaction Inflow) The container executes the called method under this
transaction. On the other hand when the bean shown in figure 50 calls web
services, the transaction context associated with the current thread is
automatically propagated along those calls by exporting the local transaction
as an atomic transaction. Had bean managed transaction demarcation been used
instead of container managed demarcation, it would not make any difference to
propagation of transactional state on web service requests made from J2EE.<span
style='mso-spacerun:yes'>  </span>The local transaction may or may not have
been imported. Very little if at all, work needs to be done when exporting
imported transactions since a coordination context is already available. The same
applies vise versa. Bean managed transaction demarcation cannot be used when
bean methods have to execute under client’s transaction context, however.</p>

<p class=NormalIndented>It should be emphasized that the mechanisms explained
in this chapter handle importing and exporting transactional state on web
service invocations, behind JTA. In other words, the whole process is
transparent to the bean programmer. Certain proprietary J2EE vendors such as
IBM have added extensions to their J2EE products (e.g. <span class=SpellE>WebSphere</span>)
that allow atomic transactions to be imported into J2EE. However, no known J2EE
implementation as of this date (June, 2004) support exporting transactional
state from J2EE as described here.</p>

<p class=MsoNormal align=center style='text-align:center'><!--[if mso & !supportInlineShapes & supportFields]><span
style='mso-element:field-begin;mso-field-lock:yes'></span><span
style='mso-spacerun:yes'> </span>SHAPE<span style='mso-spacerun:yes'> 
</span>\* MERGEFORMAT <span style='mso-element:field-separator'></span><![endif]--><!--[if gte vml 1]><v:shape
 id="_x0000_s1030" type="#_x0000_t202" style='width:6in;height:406.8pt;
 mso-position-horizontal-relative:char;mso-position-vertical-relative:line'
 filled="f">
 <v:textbox style='mso-next-textbox:#_x0000_s1030'>
  <![if !mso]>
  <table cellpadding=0 cellspacing=0 width="100%">
   <tr>
    <td><![endif]>
    <div>
    <p class=MsoNormal style='line-height:normal'><span class=GramE><span
    class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt'>public</span></span></span><span
    class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt'>
    class <span class=SpellE>TellerBean</span> implements <span class=SpellE>SessionBean</span>
    {<o:p></o:p></span></span></p>
    <p class=MsoNormal style='text-indent:36.0pt;line-height:normal'><span
    class=GramE><span class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:
    12.0pt'>private</span></span></span><span class=Inlinecode><span
    style='font-size:9.0pt;mso-bidi-font-size:12.0pt'> <span class=SpellE>SessionContext</span>
    <span class=SpellE>ctx</span>;<o:p></o:p></span></span></p>
    <p class=MsoNormal style='text-indent:36.0pt;line-height:normal'><span
    class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt'>...<o:p></o:p></span></span></p>
    <p class=MsoNormal style='text-indent:36.0pt;line-height:normal'><span
    class=GramE><span class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:
    12.0pt'>public</span></span></span><span class=Inlinecode><span
    style='font-size:9.0pt;mso-bidi-font-size:12.0pt'> <span class=SpellE>boolean</span>
    transfer(<span class=SpellE>int</span> <span class=SpellE>accountNoFrom</span>,<o:p></o:p></span></span></p>
    <p class=MsoNormal style='margin-left:36.0pt;text-indent:36.0pt;line-height:
    normal'><span class=SpellE><span class=GramE><span class=Inlinecode><span
    style='font-size:9.0pt;mso-bidi-font-size:12.0pt'>int</span></span></span></span><span
    class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt'> <span
    class=SpellE>accountNoTo</span>, double amount) {<o:p></o:p></span></span></p>
    <p class=MsoNormal style='margin-left:36.0pt;text-indent:36.0pt;line-height:
    normal'><span class=GramE><span class=Inlinecode><span style='font-size:
    9.0pt;mso-bidi-font-size:12.0pt'>try</span></span></span><span
    class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt'> {<o:p></o:p></span></span></p>
    <p class=MsoNormal style='margin-left:36.0pt;text-indent:36.0pt;line-height:
    normal'><span class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:
    12.0pt'><span style='mso-tab-count:1'>       </span>//<span
    style='mso-tab-count:1'>     </span>get a reference to the web service<o:p></o:p></span></span></p>
    <p class=MsoNormal style='margin-left:72.0pt;text-indent:36.0pt;line-height:
    normal'><span class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:
    12.0pt'>Bank <span class=SpellE>bank</span>= new <span class=SpellE><span
    class=GramE>BankServiceLocator</span></span><span class=GramE>(</span>).<span
    class=SpellE>getBank</span>();<o:p></o:p></span></span></p>
    <p class=MsoNormal style='margin-left:72.0pt;text-indent:36.0pt;line-height:
    normal'><span class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:
    12.0pt'>//<span style='mso-tab-count:1'>     </span>attempt the transfer <o:p></o:p></span></span></p>
    <p class=MsoNormal style='margin-left:72.0pt;text-indent:36.0pt;line-height:
    normal'><span class=SpellE><span class=GramE><span class=Inlinecode><span
    style='font-size:9.0pt;mso-bidi-font-size:12.0pt'>bank.credit</span></span></span></span><span
    class=GramE><span class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:
    12.0pt'>(</span></span></span><span class=SpellE><span class=Inlinecode><span
    style='font-size:9.0pt;mso-bidi-font-size:12.0pt'>accountNoTo</span></span></span><span
    class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt'>,
    amount);<o:p></o:p></span></span></p>
    <p class=MsoNormal style='margin-left:72.0pt;text-indent:36.0pt;line-height:
    normal'><span class=SpellE><span class=GramE><span class=Inlinecode><span
    style='font-size:9.0pt;mso-bidi-font-size:12.0pt'>bank.debit</span></span></span></span><span
    class=GramE><span class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:
    12.0pt'>(</span></span></span><span class=SpellE><span class=Inlinecode><span
    style='font-size:9.0pt;mso-bidi-font-size:12.0pt'>accountNoFrom</span></span></span><span
    class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt'>,
    amount);<o:p></o:p></span></span></p>
    <p class=MsoNormal style='margin-left:72.0pt;text-indent:36.0pt;line-height:
    normal'><span class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:
    12.0pt'>//<span style='mso-tab-count:1'>     </span>check for validity and
    rollback if invalid<o:p></o:p></span></span></p>
    <p class=MsoNormal style='margin-left:72.0pt;text-indent:36.0pt;line-height:
    normal'><span class=GramE><span class=Inlinecode><span style='font-size:
    9.0pt;mso-bidi-font-size:12.0pt'>double</span></span></span><span
    class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt'>
    balance= <span class=SpellE>bank.getBalance</span>(<span class=SpellE>accountNoFrom</span>);<o:p></o:p></span></span></p>
    <p class=MsoNormal style='margin-left:72.0pt;text-indent:36.0pt;line-height:
    normal'><span class=GramE><span class=Inlinecode><span style='font-size:
    9.0pt;mso-bidi-font-size:12.0pt'>if</span></span></span><span
    class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt'>
    (balance &lt; 0) {<o:p></o:p></span></span></p>
    <p class=MsoNormal style='margin-left:108.0pt;text-indent:36.0pt;
    line-height:normal'><span class=SpellE><span class=GramE><span
    class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt'>ctx.setRollbackOnly</span></span></span></span><span
    class=GramE><span class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:
    12.0pt'>(</span></span></span><span class=Inlinecode><span
    style='font-size:9.0pt;mso-bidi-font-size:12.0pt'>);<o:p></o:p></span></span></p>
    <p class=MsoNormal style='margin-left:108.0pt;text-indent:36.0pt;
    line-height:normal'><span class=GramE><span class=Inlinecode><span
    style='font-size:9.0pt;mso-bidi-font-size:12.0pt'>return</span></span></span><span
    class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt'>
    false;<o:p></o:p></span></span></p>
    <p class=MsoNormal style='margin-left:72.0pt;text-indent:36.0pt;line-height:
    normal'><span class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:
    12.0pt'>}<o:p></o:p></span></span></p>
    <p class=MsoNormal style='margin-left:72.0pt;text-indent:36.0pt;line-height:
    normal'><span class=GramE><span class=Inlinecode><span style='font-size:
    9.0pt;mso-bidi-font-size:12.0pt'>return</span></span></span><span
    class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt'>
    true;<o:p></o:p></span></span></p>
    <p class=MsoNormal style='margin-left:36.0pt;text-indent:36.0pt;line-height:
    normal'><span class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:
    12.0pt'>}<o:p></o:p></span></span></p>
    <p class=MsoNormal style='margin-left:36.0pt;text-indent:36.0pt;line-height:
    normal'><span class=GramE><span style='font-size:9.0pt;font-family:"Courier New"'>catch</span></span><span
    style='font-size:9.0pt;font-family:"Courier New"'> (Exception e) {<o:p></o:p></span></p>
    <p class=MsoNormal style='margin-left:72.0pt;text-indent:36.0pt;line-height:
    normal'><span class=SpellE><span class=GramE><span style='font-size:9.0pt;
    font-family:"Courier New"'>ctx.setRollbackOnly</span></span></span><span
    class=GramE><span style='font-size:9.0pt;font-family:"Courier New"'>(</span></span><span
    style='font-size:9.0pt;font-family:"Courier New"'>);<o:p></o:p></span></p>
    <p class=MsoNormal style='margin-left:72.0pt;text-indent:36.0pt;line-height:
    normal'><span class=GramE><span style='font-size:9.0pt;font-family:"Courier New"'>throw</span></span><span
    style='font-size:9.0pt;font-family:"Courier New"'> new <span class=SpellE>RuntimeException</span>(e);<o:p></o:p></span></p>
    <p class=MsoNormal style='margin-left:36.0pt;text-indent:36.0pt;line-height:
    normal'><span style='font-size:9.0pt;font-family:"Courier New"'>}<o:p></o:p></span></p>
    <p class=MsoNormal style='text-indent:36.0pt;line-height:normal'><span
    style='font-size:9.0pt;font-family:"Courier New"'>}<o:p></o:p></span></p>
    <p class=MsoNormal style='line-height:normal'><span style='font-size:9.0pt;
    font-family:"Courier New"'>}<o:p></o:p></span></p>
    <p class=MsoNormal style='line-height:normal'><span style='font-size:9.0pt;
    font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>
    </div>
    <![if !mso]></td>
   </tr>
  </table>
  <![endif]></v:textbox>
 <w:wrap type="none"/>
 <w:anchorlock/>
</v:shape><![endif]--><![if !vml]><img width=582 height=548
src="ws-tx_files/image007.gif"
alt="Text Box: public class TellerBean implements SessionBean {&#13;&#10;private SessionContext ctx;&#13;&#10;...&#13;&#10;public boolean transfer(int accountNoFrom,&#13;&#10;int accountNoTo, double amount) {&#13;&#10;try {&#13;&#10;	//	get a reference to the web service&#13;&#10;Bank bank= new BankServiceLocator().getBank();&#13;&#10;//	attempt the transfer &#13;&#10;bank.credit(accountNoTo, amount);&#13;&#10;bank.debit(accountNoFrom, amount);&#13;&#10;//	check for validity and rollback if invalid&#13;&#10;double balance= bank.getBalance(accountNoFrom);&#13;&#10;if (balance &lt; 0) {&#13;&#10;ctx.setRollbackOnly();&#13;&#10;return false;&#13;&#10;}&#13;&#10;return true;&#13;&#10;}&#13;&#10;catch (Exception e) {&#13;&#10;ctx.setRollbackOnly();&#13;&#10;throw new RuntimeException(e);&#13;&#10;}&#13;&#10;}&#13;&#10;}&#13;&#10;&#13;&#10;"
v:shapes="_x0000_s1030"><![endif]><!--[if mso & !supportInlineShapes & supportFields]><v:shape
 id="_x0000_i1026" type="#_x0000_t75" style='width:6in;height:406.8pt'>
 <v:imagedata croptop="-65520f" cropbottom="65520f"/>
</v:shape><span style='mso-element:field-end'></span><![endif]--></p>

<p class=MsoCaption align=center style='text-align:center'>Figure <!--[if supportFields]><span
style='mso-element:field-begin'></span><span
style='mso-spacerun:yes'> </span>SEQ Figure \* ARABIC <span style='mso-element:
field-separator'></span><![endif]--><span style='mso-no-proof:yes'>7</span><!--[if supportFields]><span
style='mso-element:field-end'></span><![endif]-->: An EJB with container
managed transaction demarcation</p>

<h2 style='margin-left:0cm;text-indent:0cm'><![if !supportLists]><span
style='mso-fareast-font-family:Arial;font-variant:normal !important;text-transform:
uppercase'><span style='mso-list:Ignore'>2.3 </span></span><![endif]><span
style='font-variant:normal !important;text-transform:uppercase'>Implementation<o:p></o:p></span></h2>

<h3 style='margin-left:0cm;text-indent:0cm'><![if !supportLists]><span
style='mso-fareast-font-family:Arial;font-variant:normal !important;text-transform:
uppercase'><span style='mso-list:Ignore'>2.3.1 </span></span><![endif]><span
style='font-variant:normal !important;text-transform:uppercase'>Architectural
design<o:p></o:p></span></h3>

<h4 style='margin-left:0cm;text-indent:0cm'><![if !supportLists]><span
style='font-variant:normal !important;text-transform:uppercase;text-decoration:
none;text-underline:none'><span style='mso-list:Ignore'>2.3.1.1 </span></span><![endif]><span
style='font-variant:normal !important;text-transform:uppercase'>Transaction
Inflow<o:p></o:p></span></h4>

<p class=MsoNormal>Transaction inflow takes place when a web service request
contains a coordination context. The sequence diagram in figure 52 shows the
steps required to import a transaction into the J2EE environment.</p>

<p class=MsoNormal align=center style='text-align:center;page-break-after:avoid'><span
style='mso-spacerun:yes'> </span><!--[if gte vml 1]><v:shape id="_x0000_i1032"
 type="#_x0000_t75" style='width:513pt;height:429pt'>
 <v:imagedata src="ws-tx_files/image008.gif" o:title="_image015"/>
</v:shape><![endif]--><![if !vml]><img width=684 height=572
src="ws-tx_files/image008.gif" v:shapes="_x0000_i1032"><![endif]></p>

<p class=MsoCaption align=center style='text-align:center'>Figure <!--[if supportFields]><span
style='mso-element:field-begin'></span><span
style='mso-spacerun:yes'> </span>SEQ Figure \* ARABIC <span style='mso-element:
field-separator'></span><![endif]--><span style='mso-no-proof:yes'>8</span><!--[if supportFields]><span
style='mso-element:field-end'></span><![endif]-->: Sequence diagram -
transaction inflow</p>

<p class=MsoNormal>The Server Axis Engine calls the Transaction Handler twice
for each operation. Once on request flow before the actual operation is invoked
and again during the response flow after the operation has been carried out. On
the request flow, the Transaction Handler looks among the message header
elements for a coordination context. If it finds one, it then calls the Bridge
indicating an inflow of transaction. The Bridge first determines whether this
coordination context corresponds to a transaction that has been imported
earlier. If not, it calls the Transaction Importer requesting that it create a
new local transaction. The Bridge also supplies a new <span class=SpellE><span
class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt;
line-height:150%;mso-bidi-font-family:"Times New Roman"'>Xid</span></span></span>
and a timeout for the new transaction. The <span class=SpellE><span
class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt;
line-height:150%;mso-bidi-font-family:"Times New Roman"'>Xid</span></span></span>
is created by the Bridge but the timeout value is obtained from the
coordination context using the Expires attribute. The Transaction Importer
returns a new local transaction, i.e. <span class=SpellE><span
class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt;
line-height:150%;mso-bidi-font-family:"Times New Roman"'>javax.transaction.Transaction</span></span></span>.
Next, the Bridge registers for participation in the activity by sending the <span
class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt;
line-height:150%;mso-bidi-font-family:"Times New Roman"'>Register</span></span>
message to the Registration Service endpoint given in the coordination context.
The Bridge requests participation in the Durable 2PC [30] protocol.</p>

<p class=NormalIndented>The Bridge also maintains two hash maps. One is keyed
by local transactions and contains corresponding coordination contexts. The
other is keyed by activity identifiers (extracted from the coordination
context) and contains corresponding local transactions. During transaction
inflow, the Bridge tries to lookup a local transaction by the activity
identifier in the second hash map before requesting the Transaction Importer to
create a new local transaction. If it succeeds in finding one, no new
transaction is created. This ensures that only one branch is created for any
one global transaction within the local domain. If the Bridge fails to lookup a
local transaction in the second hash map, this indicates that the coordination
context corresponds to a new global transaction. Hence a new branch is created
as described in the preceding paragraph. After creating the new transaction,
both the coordination context and the local transaction are added to the hash
maps. Finally, the local transaction is then returned to the Axis Transaction
Handler.</p>

<p class=NormalIndented>The Transaction Handler then requests the Transaction
Manager to attach the local transaction returned by the Bridge to the current
thread. This results in the service implementation bean which could be a
JAX-RPC service endpoint or an EJB, being invoked in the context of this local
transaction. On the response flow, the Transaction Handler detaches the local
transaction from the current thread.</p>

<p class=NormalIndented>Note that when a coordination context is imported, the
Bridge may not have to create a new local transaction under two scenarios. In
the trivial case if the coordination context has been imported earlier, it
already has an associated local transaction. On the other hand the coordination
context may have been created as a result of transaction outflow, described in
the next section.</p>

<p class=MsoNormal align=center style='text-align:center;page-break-after:avoid'><!--[if gte vml 1]><v:shape
 id="_x0000_i1033" type="#_x0000_t75" style='width:449.25pt;height:217.5pt'>
 <v:imagedata src="ws-tx_files/image009.gif" o:title="image017"/>
</v:shape><![endif]--><![if !vml]><img width=599 height=290
src="ws-tx_files/image009.gif" v:shapes="_x0000_i1033"><![endif]></p>

<p class=MsoCaption align=center style='text-align:center'>Figure <!--[if supportFields]><span
style='mso-element:field-begin'></span><span
style='mso-spacerun:yes'> </span>SEQ Figure \* ARABIC <span style='mso-element:
field-separator'></span><![endif]--><span style='mso-no-proof:yes'>9</span><!--[if supportFields]><span
style='mso-element:field-end'></span><![endif]-->: Sequence diagram - Instance
termination of an imported transaction</p>

<p class=MsoNormal>Figure 53 shows the sequence of events that take place
during termination of an atomic transaction having a local branch. The figure
assumes that the Completion Initiator [30] has requested the coordination
service to commit the transaction. The coordination service carries out the
two-phase commit protocol as specified by WS-AT.</p>

<p class=NormalIndented>When the Bridge receives the <span class=Inlinecode><span
style='font-size:9.0pt;mso-bidi-font-size:10.0pt;line-height:150%;mso-bidi-font-family:
"Times New Roman"'>Prepare</span></span> message the global transaction is
identified by its activity identifier. Note that the activity identifier is not
sent as part of the <span class=Inlinecode><span style='font-size:9.0pt;
mso-bidi-font-size:10.0pt;line-height:150%;mso-bidi-font-family:"Times New Roman"'>Prepare</span></span>
message. It is sent by the coordination service as it was included among the
reference properties for the Participant endpoint of the Bridge, when the
Bridge registered for participation in the activity during transaction inflow.
Using the hash map keyed by the activity identifier, the Bridge then locates
the <span class=SpellE><span class=Inlinecode><span style='font-size:9.0pt;
mso-bidi-font-size:10.0pt;line-height:150%;mso-bidi-font-family:"Times New Roman"'>Xid</span></span></span>
it assigned for the local branch of this atomic transaction. Next, the Bridge
uses the JCA <span class=SpellE><span class=Inlinecode><span style='font-size:
9.0pt;mso-bidi-font-size:10.0pt;line-height:150%;mso-bidi-font-family:"Times New Roman"'>XATerminator</span></span></span>
interface [39] to carry out the requested two-phase commit operation on the
local branch.</p>

<h4 style='margin-left:0cm;text-indent:0cm'><![if !supportLists]><span
style='font-variant:normal !important;text-transform:uppercase;text-decoration:
none;text-underline:none'><span style='mso-list:Ignore'>2.3.1.2 </span></span><![endif]><span
style='font-variant:normal !important;text-transform:uppercase'>Transaction
outflow<o:p></o:p></span></h4>

<p class=MsoNormal>Transaction outflow occurs when a thread with a transaction
context invokes a web service. The sequence diagram in figure 54 depicts the
actions taken on transaction outflow. The Client Axis Engine invokes the
Transaction Handler. The Transaction Handler checks to see whether the executing
thread has a transaction context. This is done by calling the <span
class=SpellE><span class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:
12.0pt;line-height:150%;mso-bidi-font-family:"Times New Roman"'>getTransaction</span></span></span>
method of the transaction manager (<span class=SpellE><span class=Inlinecode><span
style='font-size:9.0pt;mso-bidi-font-size:12.0pt;line-height:150%;mso-bidi-font-family:
"Times New Roman"'>javax.transaction.TransactionManager</span></span></span>)
which returns the transaction object (<span class=SpellE><span
class=Inlinecode><span style='font-size:9.0pt;mso-bidi-font-size:12.0pt;
line-height:150%;mso-bidi-font-family:"Times New Roman"'>javax.transaction.Transaction</span></span></span>)
associated with the current thread if there is one. Next, if the current thread
has a transaction context, the handler indicates to the Bridge an outflow of
transaction and passes it the transaction to be exported.</p>

<p class=MsoNormal align=center style='text-align:center;page-break-after:avoid'><span
style='mso-spacerun:yes'> </span><!--[if gte vml 1]><v:shape id="_x0000_i1034"
 type="#_x0000_t75" style='width:504.75pt;height:355.5pt'>
 <v:imagedata src="ws-tx_files/image010.gif" o:title="image018"/>
</v:shape><![endif]--><![if !vml]><img width=673 height=474
src="ws-tx_files/image010.gif" v:shapes="_x0000_i1034"><![endif]></p>

<p class=MsoCaption align=center style='text-align:center'>Figure <!--[if supportFields]><span
style='mso-element:field-begin'></span><span
style='mso-spacerun:yes'> </span>SEQ Figure \* ARABIC <span style='mso-element:
field-separator'></span><![endif]--><span style='mso-no-proof:yes'>10</span><!--[if supportFields]><span
style='mso-element:field-end'></span><![endif]-->: Sequence diagram -
Transaction outflow</p>

<p class=MsoNormal>Here, the Bridge first checks the hash map keyed by local
transactions for an associated coordination context. If it finds one it is
returned to the handler. This may occur in two scenarios. First, the particular
local transaction may be the local branch of an atomic transaction; i.e. has
been created as a result of transaction inflow. On the other hand the
transaction may have been export earlier as a result of transaction outflow.
The latter could occur if a thread makes multiple web service invocations. In
such a scenario, after the first invocation is made, on subsequent invocations,
a coordination context is available for the particular local transaction or in
other words the local transaction represents the local branch of an atomic
transaction.</p>

<p class=NormalIndented>If a coordination context is not available, the Bridge
requests the Coordination Service to interpose in the local transaction.
WS-Coordination describes how interposition may be used to import an existing
activity into a coordinator [29]. However, the interposition as described here
is different from what is described by WS-Coordination in that the coordinator
is given a local transaction instead of a coordination context. Still, the
basic idea remains the same. From WS-Coordination’s perspective, importing an
activity has several motivations. For example, it allows an application to use
an intermediary set of coordination services that it prefers to deal with
directly due to performance, trust domain or control reasons. In a federated
environment of autonomous services, this is especially necessary given the
arbitrary trust relationships that may exist between them. In the context of
transaction outflow, interposition is still used for the same reason, to create
an alternate coordination body which is preferred by a section of participants
to the current coordinator. In this case however, the local transaction manager
is unable to coordinate the participants in the web services domain. Hence an
alternate coordinator is required who is capable of coordinating with those
participants while interacting with the local coordinator.</p>

<p class=NormalIndented>In the interposition scenario described by
WS-Coordination no new activity is created. The coordination context returned
by the interposing coordinator carries the same activity identifier as the
first coordination context. Only the registration service endpoint is changed.
However in transaction outflow, a new atomic transaction (a new activity) is
created. Thereon the local transaction becomes the local branch of this atomic
transaction.</p>

<p class=NormalIndented>The coordination context corresponding to the new
atomic transaction is returned to the Bridge. The Bridge then updates its hash
maps and returns the coordination context to the Transaction Handler. Notice,
that the Bridge does not register it self as a participant of the new activity
like it did in transaction inflow. The association between the local branch and
the atomic transaction is handled by the coordination service.</p>

<p class=NormalIndented>Latter point warrants an explanation. Notice that
termination of the global transaction may be triggered by two different
sources. On one hand it may be terminated via the Completion protocol from a
possible external application domain. However, the more likely scenario is
that, it would be instigated by the termination of the local transaction (or
the local branch). In the latter case we must ensure the termination of the
atomic transaction happens in sync with the termination of the local
transaction or in other words, when the local transaction manager initiates the
two-phase commit protocol for the local transaction, the atomic transaction
must also start its own 2PC. Further the results of the votes gathered from web
service participants must be taken into account in deciding the outcome of the
Prepare phase of the local transaction.</p>

<p class=NormalIndented>Now consider the case where the Bridge registers for
the Completion Protocol with the objective of terminating the atomic
transaction in sync with the local transaction. Unfortunately, the Completion
protocol [30] provides no way of preparing the participants of an atomic
transaction. It only allows the transaction to be committed or rolled back in
one unit step. Hence the above requirement cannot be met by this approach.</p>

<p class=NormalIndented>The solution is to let the coordinator (the
coordination service) be a participant of the local transaction. Thus when the
local transaction manager initiates two-phase commit on the local resources and
asks the coordinator to prepare itself, the coordinator can carry out two-phase
commit on the web service participants. The decision reached there is conveyed
to the local transaction manager as the response of the coordinator. Hence the
final decision taken by the local transaction manager is the same as if all
participants were coordinated by the local transaction manager alone.</p>

<h3 style='margin-left:0cm;text-indent:0cm'><![if !supportLists]><span
style='mso-fareast-font-family:Arial;font-variant:normal !important;text-transform:
uppercase'><span style='mso-list:Ignore'>2.3.2 </span></span><![endif]><span
style='font-variant:normal !important;text-transform:uppercase'>Unresolved
Issues<o:p></o:p></span></h3>

<p class=MsoNormal>One problem that crops up with transaction outflow is how to
handle timeouts. WS-Coordination recommends each coordination context carry an
optional Expires attribute. This attribute is used by the transaction inflow
mechanism to set a timeout when creating local transactions. However, when
exporting local transactions, there is no way to find out when it was created
and as result, how much time remains before the instance timeouts. Thus the
Expires attribute cannot be initialized to its correct value. A conservative
solution is to set the Expires attribute to the maximum timeout possible.</p>

<h3 style='margin-left:0cm;text-indent:0cm'><![if !supportLists]><span
style='mso-fareast-font-family:Arial;font-variant:normal !important;text-transform:
uppercase'><span style='mso-list:Ignore'>2.3.3 </span></span><![endif]><span
style='font-variant:normal !important;text-transform:uppercase'>Possible Future
Extensions<o:p></o:p></span></h3>

<p class=MsoNormal>The above framework does not illustrate how transaction
policies defined for a particular J2EE component are published when the components
functionality is exposed as a web service. The framework as it stands at
present only handles the enforcement of such policies. This necessitates the
use WS-Policy and requires a broader discussion among parties interested in the
area. No known implementation at present provides this functionality.</p>

<p class=NormalIndented>At present, the only way in which a transaction could
propagate from one J2EE domain to another is through JTS. However, with the
integration of J2EE and web services, another indirect path also becomes available.
A J2EE transaction may propagate from one J2EE domain to another as a result of
invoking a J2EE web service. However, as WS-<span class=SpellE>AtomicTransaction</span>
[9] does not use <span class=SpellE>Xid</span> s [14] to identify transactions,
there is no way in which the <span class=SpellE>Xid</span> of a J2EE transaction
can be propagated from one J2EE domain to another through web services.
Consequently, transaction propagation between J2EE domains through web services
is incompatible with JTS. For example, consider one J2EE component calling
another J2EE component and a web service, residing in the same J2EE domain. In
the first case propagation of transactional state is handled by JTS and will
result in the creation of a new branch in the second domain. However, when the
web service is called yet another branch will be created, which is undesirable.
A possible solution is the use of Extension elements [29] to propagate <span
class=SpellE>Xid</span> s where it is applicable. </p>

</div>

</body>

</html>
